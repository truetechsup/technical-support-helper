<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫</h1>
            <p class="subtitle">Technical Support Helper</p>
            <nav class="main-nav">
                <a href="/" class="active">üîç –ü–æ–∏—Å–∫</a>
                <a href="/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
            </nav>
        </header>

        <main>
            <div class="search-section">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–ª–∏ –µ–≥–æ —á–∞—Å—Ç—å..."
                        autocomplete="off"
                    >
                    <button id="searchButton">–ü–æ–∏—Å–∫</button>
                </div>
                <div id="loading" class="loading" style="display: none;">
                    –ü–æ–∏—Å–∫...
                </div>
            </div>

            <div id="results" class="results"></div>
        </main>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');

        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
        searchButton.addEventListener('click', performSearch);

        function performSearch() {
            const query = searchInput.value.trim();
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞</div>';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';

            // AJAX –∑–∞–ø—Ä–æ—Å
            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                loadingDiv.style.display = 'none';
                
                if (data.error) {
                    resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${data.error}</div>`;
                    return;
                }

                const results = data.results || [];
                
                if (results.length === 0) {
                    resultsDiv.innerHTML = '<div class="no-results">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                let html = `<div class="results-count">–ù–∞–π–¥–µ–Ω–æ: ${results.length}</div>`;
                
                results.forEach(result => {
                    html += `
                        <div class="error-card">
                            <div class="error-header">
                                <h3>${escapeHtml(result.error)}</h3>
                            </div>
                            
                            ${result.description ? `
                                <div class="error-section">
                                    <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                                    <p>${escapeHtml(result.description)}</p>
                                </div>
                            ` : ''}
                            
                            ${result.solution ? `
                                <div class="error-section">
                                    <strong>–†–µ—à–µ–Ω–∏–µ:</strong>
                                    <p>${escapeHtml(result.solution)}</p>
                                </div>
                            ` : ''}
                            
                            ${result.tickets && result.tickets.length > 0 ? `
                                <div class="error-section">
                                    <strong>–ù–æ–º–µ—Ä–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π:</strong>
                                    <ul class="ticket-list">
                                        ${result.tickets.map(ticket => `<li>${escapeHtml(ticket)}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.tasks && result.tasks.length > 0 ? `
                                <div class="error-section">
                                    <strong>–ó–∞–¥–∞—á–∏:</strong>
                                    <ul class="task-list">
                                        ${result.tasks.map(task => `<li><a href="${escapeHtml(task)}" target="_blank">${escapeHtml(task)}</a></li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                resultsDiv.innerHTML = html;
            })
            .catch(error => {
                loadingDiv.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}</div>`;
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

